<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <title>تقرير المدرسين</title>
    {% load static %}
    {% include 'parts/header.html' %}
    <link rel="stylesheet" href="{% static 'css/bootstrap.css' %}">
    {# Add any specific CSS for this page if needed #}
    <style>
        @media print {
            body {
                margin: 0;
                padding: 0;
                size: A4 landscape; /* Print in landscape orientation */
                font-size: 10pt; /* Adjust font size for printing */
            }
            .container {
                width: 100%;
                margin: 0;
                padding: 0;
            }
            .no-print {
                display: none !important;
            }
            table {
                width: 100%;
                border-collapse: collapse; /* Collapse borders for a cleaner look */
                margin-bottom: 1em; /* Add some space below the table */
            }
            th, td {
                border: 1px solid #000; /* Add borders to cells */
                padding: 8px; /* Add padding to cells */
                text-align: right; /* Align text to the right for Arabic */
            }
            th {
                background-color: #f2f2f2; /* Light grey background for headers */
                font-weight: bold;
            }
            tr:nth-child(even) {
                background-color: #f9f9f9; /* Alternate row background color */
            }
            tfoot td {
                font-size: 8pt; /* Smaller font for footer */
            }
        }
    </style>
    <style>
        @media (max-width: 768px) { /* Apply styles on screens smaller than 768px */
            .table-responsive table thead {
                display: none; /* Hide table headers */
            }
            .table-responsive table,
            .table-responsive table tbody,
            .table-responsive table tr,
            .table-responsive table td {
                display: block; /* Make table elements block level */
            }
            .table-responsive table tr {
                margin-bottom: 15px;
                border: 1px solid #dee2e6;
            }
            .table-responsive table td {
                text-align: right;
                padding-left: 50%;
                position: relative;
            }
            .table-responsive table td::before {
                content: attr(data-label); /* Display data-label as a pseudo-element */
                position: absolute;
                left: 10px;
                width: 45%;
                padding-right: 10px;
                white-space: nowrap;
                font-weight: bold;
                text-align: left;
            }
        }
    </style>
</head>
<body>

    <div class="container mt-4">
        <div class="d-flex justify-content-between align-items-center mb-4">
            <h2 class="text-center mb-0">مدرسي المقرأة</h2>
            <a href="{% url 'manage_report' %}" class="btn btn-secondary btn-sm no-print">العودة</a>
        </div>

        <div class="row mb-3 no-print justify-content-center"> {# Add no-print to the search row and center content #}
            <div class="col-12 col-md-8 col-lg-6 mb-2"> {# Make search input full width on small screens, wider on medium/large #}
                <div class="input-group">
                    <input type="text" class="form-control" placeholder="ابحث عن مدرس...">
                    <button class="btn btn-primary" type="button">بحث</button>
                </div>
            </div>
            <div class="col-6 col-md-2 col-lg-2 mb-2"> {# Make print button half width on small, narrower on medium/large #}
                <button class="btn btn-secondary w-100" onclick="window.print()">طباعة التقرير</button>
            </div>
            <div class="col-6 col-md-2 col-lg-2 mb-2"> {# Make export button half width on small, narrower on medium/large #}
                <a href="{% url 'export_teacher_report_excel' %}" class="btn btn-success w-100">تصدير إلى Excel</a>
            </div>
        </div>

        <div class="table-responsive">
            <table class="table table-striped table-bordered">
                <thead>
                    <tr>
                        <th>اسم المدرس</th>
                        <th>الجنس</th>
                        <th>الجنسية</th>
                        <th>رقم الواتس الخاص بالمدرس</th>
                        <th>اسم الحلقة</th>
                        <th>اسم القراءة</th>
                        <th>اسم المسار</th>
                        <th>اسم القسم</th>
                    </tr>
                </thead>
                <tbody>
                    {% for teacher in teachers %}
                    <tr>
                        <td data-label="اسم المدرس">{{ teacher.first_name }} {{ teacher.last_name }}</td>
                        <td data-label="الجنس">{{ teacher.gender }}</td>
                        <td data-label="الجنسية">{{ teacher.nationality }}</td>
                        <td data-label="رقم الواتس الخاص بالمدرس">{{ teacher.whatsapp }}</td>
                        <td data-label="اسم الحلقة">{{ teacher.halaqa_name }}</td>
                        <td data-label="اسم القراءة">{{ teacher.typeread_name }}</td>
                        <td data-label="اسم المسار">{{ teacher.msar_name }}</td>
                        <td data-label="اسم القسم">{{ teacher.department_name }}</td>
                    </tr>
                    {% empty %}
                    <tr>
                        <td colspan="8" class="text-center">لا يوجد مدرسين لعرضهم.</td>
                    </tr>
                    {% endfor %}
                </tbody>
                <tfoot>
                    <tr>
                        <td colspan="8" class="text-center">© الخوارزمي للحلول الذكية</td>
                    </tr>
                </tfoot>
            </table>
        </div>
    </div>

    <div class="no-print">
        {% include 'parts/footer.html' %}
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    {# Add any specific JS for this page if needed #}
    <script>
        document.querySelector('.btn-primary').addEventListener('click', function() {
            const searchQuery = document.querySelector('.form-control').value;
            fetch(`{% url 'teacher_report' %}?search=${searchQuery}`)
                .then(response => response.json())
                .then(data => {
                    console.log(data); // Log the received data
                    const tableBody = document.querySelector('tbody');
                    tableBody.innerHTML = ''; // Clear existing rows
                    if (data.teachers.length > 0) {
                        data.teachers.forEach(teacher => {
                            const row = `
                                <tr>
                                    <td data-label="اسم المدرس">${teacher.first_name} ${teacher.last_name}</td>
                                    <td data-label="الجنس">${teacher.gender}</td>
                                    <td data-label="الجنسية">${teacher.nationality}</td>
                                    <td data-label="رقم الواتس الخاص بالمدرس">${teacher.whatsapp}</td>
                                    <td data-label="اسم الحلقة">${teacher.halaqa_name}</td>
                                    <td data-label="اسم القراءة">${teacher.typeread_name}</td>
                                    <td data-label="اسم المسار">${teacher.msar_name}</td>
                                    <td data-label="اسم القسم">${teacher.department_name}</td>
                                </tr>
                            `;
                            tableBody.innerHTML += row;
                        });
                    } else {
                        tableBody.innerHTML = `
                            <tr>
                                <td colspan="8" class="text-center">لا يوجد مدرسين مطابقون لبحثك.</td>
                            </tr>
                        `;
                    }
                })
                .catch(error => console.error('Error:', error));
        });
    </script>
</body>
</html>